### SQL Последовательность

SQL - запросы выполняются в определённой последовательности, которая отличается от порядка, 
в котором мы обычно пишем SQL-запрос. Эта последовательность обусловлена тем, как база 
данных оптимизирует выполнение запроса для того, чтобы он выполнялся эффективно.

1. **FROM, JOIN** (Таблицы и соединения)
   - Сначала происходит выбор таблиц или других источников данных (например, представлений) 
   через оператор FROM.
   - Если в запросе используются соединения (JOIN), то на этом этапе происходит выполнение 
   соединений.
   - Например, если у вас есть запрос с несколькими таблицами, то соединение таблиц 
   (в случае INNER JOIN, LEFT JOIN и т. д.) будет происходить в первую очередь.
2. **ON** (Условия соединения)
   - После того как таблицы были выбраны, применяется условие соединения, указанное в ON (для JOIN).
   - Это условие определяет, какие строки из соединённых таблиц должны быть сопоставлены.
3. **WHERE** (Фильтрация строк)
   - После того как строки были соединены, применяется фильтрация через WHERE.
   - Условия фильтрации проверяются для каждой строки, и строки, не соответствующие этим условиям, 
   исключаются из результата.
4. **GROUP BY** (Группировка)
   - Если в запросе используется агрегирование (например, COUNT, SUM, AVG и т. д.), то сначала 
   происходит группировка строк по значениям в указанных столбцах (с помощью GROUP BY).
   - Это нужно для того, чтобы агрегатные функции могли применяться к каждой группе.
5. **HAVING** (Фильтрация после группировки)
   - После того как данные были сгруппированы, можно применить дополнительные условия фильтрации 
   через HAVING.
   - В отличие от WHERE, который фильтрует строки до группировки, HAVING фильтрует группы данных 
   после того, как агрегатные функции были применены.
6. **SELECT** (Выбор столбцов)
   - На этом этапе происходит выбор столбцов, которые будут включены в результат. Также могут 
   применяться агрегатные функции.
7. **DISTINCT** (Удаление дубликатов)
   - Если используется ключевое слово DISTINCT, то на этом этапе происходит удаление дубликатов 
   из результата.
8. **ORDER BY** (Сортировка)
   - После того как данные были выбраны, сгруппированы и обработаны, происходит сортировка результата 
   по указанным столбцам через ORDER BY.
   - Это определяет порядок, в котором строки будут возвращены.
9. **LIMIT / OFFSET** (Ограничение и смещение)
   - В конце выполнения запроса применяется LIMIT, чтобы ограничить количество возвращаемых строк.
   - Если используется OFFSET, то строки будут пропущены (например, при пагинации).

**Пример:**
```sql
  SELECT name, COUNT(*) 
    FROM employees 
    JOIN departments ON employees.department_id = departments.id 
   WHERE salary > 50000 
   GROUP BY name 
  HAVING COUNT(*) > 1 
   ORDER BY name DESC 
   LIMIT 10 OFFSET 20
```

**Как выполняется запрос:**

1. **FROM** employees, departments — сначала выбираются таблицы.
2. **JOIN** — соединяются таблицы employees и departments по условию employees.department_id = departments.id.
3. **ON** — применяется условие соединения.
4. **WHERE** — фильтруются строки, где salary > 50000.
5. **GROUP BY** — данные группируются по столбцу name.
6. **HAVING** — фильтруются группы, где количество сотрудников больше 1.
7. **SELECT** — выбираются столбцы name и агрегированное значение COUNT(*).
8. **DISTINCT** — если было бы указано, то удалялись бы дубликаты (не в этом запросе).
9. **ORDER BY** — данные сортируются по столбцу name в порядке убывания.
10. **LIMIT** — возвращается только 10 строк.
11. **OFFSET** — пропускаются первые 20 строк.
