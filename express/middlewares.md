[Назад](../README.md)

### Объясните, как middleware работает.

Middleware — это функции, которые выполняются между отправкой клиентом запроса и отправкой ответа сервером. 
Middleware обрабатывают запросы, могут изменять объект запроса или ответа, завершить запрос, или передать его 
следующей функции middleware.

- Как работает?
    - Каждая middleware-функция в Express.js принимает три параметра:
        - req: объект запроса (request) — содержит данные о запросе клиента.
        - res: объект ответа (response) — используется для отправки ответа клиенту.
        - next: функция, вызывающая следующую middleware в цепочке. Если её не вызвать, запрос «зависнет», поскольку 
        - не будет передан дальше по обработке.
    - middleware может изменять запросы до того, как они попадут к маршрутам.
    - middleware может изменять ответы, отправляемые клиенту.
    - middleware передаёт управление следующей функции, если она сама не завершила запрос (например, не отправила ответ).
- Какие типы middleware?
  - **Application-level:** Применяется ко всему приложению.
  - **Router-level:** Применяется только к определённым маршрутам или группам маршрутов.
  - **Error-handling:** Обрабатывает ошибки. Такая middleware принимает 4 параметра: (err, req, res, next).
  - **Built-in:** Предоставляет встроенные middleware для базовых задач, таких как работа с JSON или статическими 
  файлами:
    - ``express.json():`` парсит JSON-тело запроса.
    - ``express.static('public'):`` обслуживает статические файлы из указанной директории.
  - **Third-party:** Это внешние библиотеки, которые расширяют функциональность, например (body-parser, cors, morgan).
  
Важно отметить порядок регистрации Middleware:
1. Регистрация middleware перед определением маршрутов
   - Это самый распространенный способ. Middleware будет применяться ко всем запросам, поступающим на сервер.
2. Регистрация middleware после определённых маршрутов
   - Если вы зарегистрируете middleware после маршрутов, она будет вызвана только в случае, если запрос не совпал 
   с любым маршрутом. Это часто используется для обработки ошибок или для отправки ответов на несуществующие маршруты.
3. Регистрация middleware на уровне роутера
   - Вы можете применять middleware только для определённых маршрутов, создав отдельный роутер.
4. Регистрация middleware для конкретных маршрутов
   - Вы можете применить middleware только для определённых маршрутов, указывая её непосредственно при определении маршрута.
5. Регистрация middleware для обработки ошибок
   - Ошибка обрабатывается с помощью middleware, которая принимает 4 аргумента (error, request, response, next).